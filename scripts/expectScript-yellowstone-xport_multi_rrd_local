#!/usr/bin/expect
set timeout 1
set machine [lindex $argv 0]
set port [lindex $argv 1]
set node_name [lindex $argv 2]
set metric [lindex $argv 3]
set query_date [lindex $argv 4]
spawn telnet ganglia $port
expect "'^]'."
send -- "cd yellowstone \r"
expect "'^]'."
send -- "xport -s \'00:00 $query_date\' -e \'23:59 $query_date\' --json DEF:out10=$node_name/cpu_intr.rrd:sum:AVERAGE DEF:out11=$node_name/mem_cached.rrd:sum:AVERAGE DEF:out12=$node_name/disk_free.rrd:sum:AVERAGE DEF:out13=$node_name/ib0_rcv_data.rrd:sum:AVERAGE DEF:out14=$node_name/hpm_snl_rate_usertime.rrd:sum:AVERAGE DEF:out15=$node_name/swap_free.rrd:sum:AVERAGE DEF:out16=$node_name/hpm_wallclock.rrd:sum:AVERAGE DEF:out17=$node_name/load_one.rrd:sum:AVERAGE DEF:out18=$node_name/cpu_speed.rrd:sum:AVERAGE DEF:out19=$node_name/ib0_xmit_data.rrd:sum:AVERAGE DEF:out20=$node_name/part_max_used.rrd:sum:AVERAGE DEF:out21=$node_name/bytes_out.rrd:sum:AVERAGE DEF:out22=$node_name/hpm_dbl_packed_flops.rrd:sum:AVERAGE DEF:out23=$node_name/disk_total.rrd:sum:AVERAGE DEF:out24=$node_name/hpm_dbl_scalar_flops.rrd:sum:AVERAGE DEF:out25=$node_name/proc_run.rrd:sum:AVERAGE DEF:out26=$node_name/pkts_out.rrd:sum:AVERAGE DEF:out27=$node_name/mem_free.rrd:sum:AVERAGE DEF:out28=$node_name/hpm_snl_rate_wallclock.rrd:sum:AVERAGE DEF:out29=$node_name/mem_shared.rrd:sum:AVERAGE DEF:out30=$node_name/cpu_system.rrd:sum:AVERAGE DEF:out31=$node_name/cpu_nice.rrd:sum:AVERAGE DEF:out32=$node_name/hpm_flops.rrd:sum:AVERAGE DEF:out33=$node_name/hpm_dbl_rate_usertime.rrd:sum:AVERAGE DEF:out34=$node_name/boottime.rrd:sum:AVERAGE DEF:out35=$node_name/bytes_in.rrd:sum:AVERAGE DEF:out36=$node_name/hpm_snl_packed.rrd:sum:AVERAGE DEF:out37=$node_name/pkts_in.rrd:sum:AVERAGE DEF:out38=$node_name/load_five.rrd:sum:AVERAGE DEF:out39=$node_name/cpu_aidle.rrd:sum:AVERAGE DEF:out40=$node_name/cpu_user.rrd:sum:AVERAGE DEF:out41=$node_name/hpm_dbl_rate_wallclock.rrd:sum:AVERAGE DEF:out42=$node_name/mem_buffers.rrd:sum:AVERAGE DEF:out43=$node_name/cpu_sintr.rrd:sum:AVERAGE DEF:out44=$node_name/cpu_idle.rrd:sum:AVERAGE DEF:out45=$node_name/cpu_num.rrd:sum:AVERAGE DEF:out46=$node_name/swap_total.rrd:sum:AVERAGE DEF:out47=$node_name/mem_total.rrd:sum:AVERAGE DEF:out48=$node_name/hpm_snl_scalar.rrd:sum:AVERAGE DEF:out49=$node_name/load_fifteen.rrd:sum:AVERAGE DEF:out50=$node_name/cpu_wio.rrd:sum:AVERAGE DEF:out51=$node_name/proc_total.rrd:sum:AVERAGE XPORT:out10:\'cpu_intr\' XPORT:out11:\'mem_cached\' XPORT:out12:\'disk_free\' XPORT:out13:\'ib0_rcv_data\' XPORT:out14:\'hpm_snl_rate_usertime\' XPORT:out15:\'swap_free\' XPORT:out16:\'hpm_wallclock\' XPORT:out17:\'load_one\' XPORT:out18:\'cpu_speed\' XPORT:out19:\'ib0_xmit_data\' XPORT:out20:\'part_max_used\' XPORT:out21:\'bytes_out\' XPORT:out22:\'hpm_dbl_packed_flops\' XPORT:out23:\'disk_total\' XPORT:out24:\'hpm_dbl_scalar_flops\' XPORT:out25:\'proc_run\' XPORT:out26:\'pkts_out\' XPORT:out27:\'mem_free\' XPORT:out28:\'hpm_snl_rate_wallclock\' XPORT:out29:\'mem_shared\' XPORT:out30:\'cpu_system\' XPORT:out31:\'cpu_nice\' XPORT:out32:\'hpm_flops\' XPORT:out33:\'hpm_dbl_rate_usertime\' XPORT:out34:\'boottime\' XPORT:out35:\'bytes_in\' XPORT:out36:\'hpm_snl_packed\' XPORT:out37:\'pkts_in\' XPORT:out38:\'load_five\' XPORT:out39:\'cpu_aidle\' XPORT:out40:\'cpu_user\' XPORT:out41:\'hpm_dbl_rate_wallclock\' XPORT:out42:\'mem_buffers\' XPORT:out43:\'cpu_sintr\' XPORT:out44:\'cpu_idle\' XPORT:out45:\'cpu_num\' XPORT:out46:\'swap_total\' XPORT:out47:\'mem_total\' XPORT:out48:\'hpm_snl_scalar\' XPORT:out49:\'load_fifteen\' XPORT:out50:\'cpu_wio\' XPORT:out51:\'proc_total\' \r" 
expect eof
