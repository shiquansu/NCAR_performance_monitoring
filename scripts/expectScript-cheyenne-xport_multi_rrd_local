#!/usr/bin/expect
set timeout 1
set dump [lindex $argv 0]
set dump [lindex $argv 1]
set ip [lindex $argv 2]
set port [lindex $argv 3]
set node_name [lindex $argv 4]
set metric [lindex $argv 5]
set query_date [lindex $argv 6]
spawn telnet ganglia $port
expect "'^]'."
send -- "cd Cheyenne\" \"Rack\" \"$ip\r" 
expect "'^]'."
send -- "xport -s \'00:00 $query_date\' -e \'23:59 $query_date\' --json DEF:out10=$node_name/boottime.rrd:sum:AVERAGE DEF:out11=$node_name/bytes_in.rrd:sum:AVERAGE DEF:out12=$node_name/bytes_out.rrd:sum:AVERAGE DEF:out13=$node_name/cpu_aidle.rrd:sum:AVERAGE DEF:out14=$node_name/cpu_idle.rrd:sum:AVERAGE DEF:out15=$node_name/cpu_intr.rrd:sum:AVERAGE DEF:out16=$node_name/cpu_nice.rrd:sum:AVERAGE DEF:out17=$node_name/cpu_num.rrd:sum:AVERAGE DEF:out18=$node_name/cpu_sintr.rrd:sum:AVERAGE DEF:out19=$node_name/cpu_speed.rrd:sum:AVERAGE DEF:out20=$node_name/cpu_system.rrd:sum:AVERAGE DEF:out21=$node_name/cpu_user.rrd:sum:AVERAGE DEF:out22=$node_name/cpu_wio.rrd:sum:AVERAGE DEF:out23=$node_name/disk_free.rrd:sum:AVERAGE DEF:out24=$node_name/disk_total.rrd:sum:AVERAGE DEF:out25=$node_name/hpm_dbl_packed_flops.rrd:sum:AVERAGE DEF:out26=$node_name/hpm_dbl_rate_usertime.rrd:sum:AVERAGE DEF:out27=$node_name/hpm_dbl_rate_wallclock.rrd:sum:AVERAGE DEF:out28=$node_name/hpm_dbl_scalar_flops.rrd:sum:AVERAGE DEF:out29=$node_name/hpm_flops.rrd:sum:AVERAGE DEF:out30=$node_name/hpm_snl_packed.rrd:sum:AVERAGE DEF:out31=$node_name/hpm_snl_rate_usertime.rrd:sum:AVERAGE DEF:out32=$node_name/hpm_snl_rate_wallclock.rrd:sum:AVERAGE DEF:out33=$node_name/hpm_snl_scalar.rrd:sum:AVERAGE DEF:out34=$node_name/hpm_wallclock.rrd:sum:AVERAGE DEF:out35=$node_name/ib0_rcv_data.rrd:sum:AVERAGE DEF:out36=$node_name/ib0_xmit_data.rrd:sum:AVERAGE DEF:out37=$node_name/load_fifteen.rrd:sum:AVERAGE DEF:out38=$node_name/load_five.rrd:sum:AVERAGE DEF:out39=$node_name/load_one.rrd:sum:AVERAGE DEF:out40=$node_name/mem_buffers.rrd:sum:AVERAGE DEF:out41=$node_name/mem_cached.rrd:sum:AVERAGE DEF:out42=$node_name/mem_free.rrd:sum:AVERAGE DEF:out43=$node_name/mem_shared.rrd:sum:AVERAGE DEF:out44=$node_name/mem_total.rrd:sum:AVERAGE DEF:out45=$node_name/part_max_used.rrd:sum:AVERAGE DEF:out46=$node_name/pkts_in.rrd:sum:AVERAGE DEF:out47=$node_name/pkts_out.rrd:sum:AVERAGE DEF:out48=$node_name/proc_run.rrd:sum:AVERAGE DEF:out49=$node_name/proc_total.rrd:sum:AVERAGE DEF:out50=$node_name/swap_free.rrd:sum:AVERAGE DEF:out51=$node_name/swap_total.rrd:sum:AVERAGE XPORT:out10:\'boottime\' XPORT:out11:\'bytes_in\' XPORT:out12:\'bytes_out\' XPORT:out13:\'cpu_aidle\' XPORT:out14:\'cpu_idle\' XPORT:out15:\'cpu_intr\' XPORT:out16:\'cpu_nice\' XPORT:out17:\'cpu_num\' XPORT:out18:\'cpu_sintr\' XPORT:out19:\'cpu_speed\' XPORT:out20:\'cpu_system\' XPORT:out21:\'cpu_user\' XPORT:out22:\'cpu_wio\' XPORT:out23:\'disk_free\' XPORT:out24:\'disk_total\' XPORT:out25:\'hpm_dbl_packed_flops\' XPORT:out26:\'hpm_dbl_rate_usertime\' XPORT:out27:\'hpm_dbl_rate_wallclock\' XPORT:out28:\'hpm_dbl_scalar_flops\' XPORT:out29:\'hpm_flops\' XPORT:out30:\'hpm_snl_packed\' XPORT:out31:\'hpm_snl_rate_usertime\' XPORT:out32:\'hpm_snl_rate_wallclock\' XPORT:out33:\'hpm_snl_scalar\' XPORT:out34:\'hpm_wallclock\' XPORT:out35:\'ib0_rcv_data\' XPORT:out36:\'ib0_xmit_data\' XPORT:out37:\'load_fifteen\' XPORT:out38:\'load_five\' XPORT:out39:\'load_one\' XPORT:out40:\'mem_buffers\' XPORT:out41:\'mem_cached\' XPORT:out42:\'mem_free\' XPORT:out43:\'mem_shared\' XPORT:out44:\'mem_total\' XPORT:out45:\'part_max_used\' XPORT:out46:\'pkts_in\' XPORT:out47:\'pkts_out\' XPORT:out48:\'proc_run\' XPORT:out49:\'proc_total\' XPORT:out50:\'swap_free\' XPORT:out51:\'swap_total\' \r" 
expect eof
