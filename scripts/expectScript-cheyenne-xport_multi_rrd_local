#!/usr/bin/expect
set timeout 1
set dump [lindex $argv 0]
set dump [lindex $argv 1]
set ip [lindex $argv 2]
set port [lindex $argv 3]
set node_name [lindex $argv 4]
set metric [lindex $argv 5]
set query_date [lindex $argv 6]
spawn telnet ganglia $port
expect "'^]'."
send -- "cd Cheyenne\" \"Rack\" \"$ip\r" 
expect "'^]'."
send -- "xport -s \'00:00 $query_date\' -e \'23:59 $query_date\' --json DEF:out10=$node_name/GOps.rrd:sum:AVERAGE DEF:out11=$node_name/MFLOPs.rrd:sum:AVERAGE DEF:out12=$node_name/boottime.rrd:sum:AVERAGE DEF:out13=$node_name/bytes_in.rrd:sum:AVERAGE DEF:out14=$node_name/bytes_out.rrd:sum:AVERAGE DEF:out15=$node_name/cpu_aidle.rrd:sum:AVERAGE DEF:out16=$node_name/cpu_idle.rrd:sum:AVERAGE DEF:out17=$node_name/cpu_nice.rrd:sum:AVERAGE DEF:out18=$node_name/cpu_num.rrd:sum:AVERAGE DEF:out19=$node_name/cpu_speed.rrd:sum:AVERAGE DEF:out20=$node_name/cpu_system.rrd:sum:AVERAGE DEF:out21=$node_name/cpu_user.rrd:sum:AVERAGE DEF:out22=$node_name/cpu_wio.rrd:sum:AVERAGE DEF:out23=$node_name/disk_free.rrd:sum:AVERAGE DEF:out24=$node_name/disk_total.rrd:sum:AVERAGE DEF:out25=$node_name/entropy_avail.rrd:sum:AVERAGE DEF:out26=$node_name/load_fifteen.rrd:sum:AVERAGE DEF:out27=$node_name/load_five.rrd:sum:AVERAGE DEF:out28=$node_name/load_one.rrd:sum:AVERAGE DEF:out29=$node_name/mem_buffers.rrd:sum:AVERAGE DEF:out30=$node_name/mem_cached.rrd:sum:AVERAGE DEF:out31=$node_name/mem_free.rrd:sum:AVERAGE DEF:out32=$node_name/mem_shared.rrd:sum:AVERAGE DEF:out33=$node_name/mem_total.rrd:sum:AVERAGE DEF:out34=$node_name/part_max_used.rrd:sum:AVERAGE DEF:out35=$node_name/pkts_in.rrd:sum:AVERAGE DEF:out36=$node_name/pkts_out.rrd:sum:AVERAGE DEF:out37=$node_name/proc_run.rrd:sum:AVERAGE XPORT:out10:\'GOps\' XPORT:out11:\'MFLOPs\' XPORT:out12:\'boottime\' XPORT:out13:\'bytes_in\' XPORT:out14:\'bytes_out\' XPORT:out15:\'cpu_aidle\' XPORT:out16:\'cpu_idle\' XPORT:out17:\'cpu_nice\' XPORT:out18:\'cpu_num\' XPORT:out19:\'cpu_speed\' XPORT:out20:\'cpu_system\' XPORT:out21:\'cpu_user\' XPORT:out22:\'cpu_wio\' XPORT:out23:\'disk_free\' XPORT:out24:\'disk_total\' XPORT:out25:\'entropy_avail\' XPORT:out26:\'load_fifteen\' XPORT:out27:\'load_five\' XPORT:out28:\'load_one\' XPORT:out29:\'mem_buffers\' XPORT:out30:\'mem_cached\' XPORT:out31:\'mem_free\' XPORT:out32:\'mem_shared\' XPORT:out33:\'mem_total\' XPORT:out34:\'part_max_used\' XPORT:out35:\'pkts_in\' XPORT:out36:\'pkts_out\' XPORT:out37:\'proc_run\' \r" 
expect eof
